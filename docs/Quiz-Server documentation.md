# Quiz-Server documentation

## Models

### User

Django standard user. Populated on register (TODO) or by post (autologin_quizserver.py).

Important fields:

- username
- name
- is_staff

### Game

Fields:

- name
- expected_start_time: timestamp
- real_start_time: timestamp blank=True
- finished_time: timestamp blank=True
- is_active: bool. Only one game can be active

### Question

- game: (foreign key)
- question_text

Enforce only one Answer_option in answer_option_set can be correct for each question

### Answer_Option

Fields:

- question: (foreign key)
- answer_option_text
- is_correct

### Vote

Fields:

- user: (foreign_key)
- answer_option: (foreign key)
- vote_time: timestamp (auto_add=True)

Created per player when they click on an Answer_option. user and answer_option_question are UNIQUE TOGETHER

## WebSocket Messages

```json
// Name: startGameMessage
// Description: Anounces the beggining of active game when the operator clicks start action.
// Sent by: Control
// Received by: Clients through server
// Fields
{
    'type': "start"
}
```
```json
// Name: nextQuestionMessage
// Description: Activates a question of the game for the players to vote.
// Sent by: Control
// Received by: Server
// Fields
{
    'type': "nextQuestion",
    'questionId': string //Database ID of Question object.
}
```
```json
// Name: questionShowResultsMessage
// Description: Activates the question result overlay in players, deactivating (if still active) the question overlay.
// Sent by: Control
// Received by: Server
// Fields
{
    'type': "showQuestionResult",
    'questionId': string //Database ID of Question object.
}
```
```json
// Name: showActualScoreboardMessage
// Description: Activates the game Scoreboard for the players.
// Sent by: Control
// Received by: Server
// Fields
{
    'type': "showActualBoard"
}
```
```json
// Name: showGeneralScoreboardMessage
// Description: Activates the Scoreboard relative to ALL played games for the players.
// Sent by: Control
// Received by: Server
// Fields
{
    'type': "showGeneralBoard"
}
```
```json
// Name: endRequestMessage
// Description: Sent by operator when the game (livestream) is about to finish to assure correct termination.
// Sent by: Control
// Received by: Server
// Fields
{
    'type': "endRequest"
}
```
```json
// Name: livePlayerStatsMessage
// Description:
// Sent by: Control
// Received by: Players through server
// Fields
{
    'type': "livePlayerStats",
    'liveViewers' : number, //People watching livestream
    'alivePlayers' : number, //Players still alive (answering questions)
    'totalPlayers' : number //Initial alive players
}

```
```json
// Name: hideMessage
// Description: Message generated by Control to hide whatever element is on the screen and show only the video.
// Sent by: Control
// Received by: Players through server
// Fields
{
    'type': "hide",
}
```
```json
// Name: voteMessage
// Description: Message generated by player app when they tap an answer for the active question.
// Sent by: Player
// Received by: Server
// Fields
{
    'type': "vote",
    'answerOptionId': string //Database ID of Answer_option object clicked.
}
```
```json
// Name: questionResultMessage
// Description: 
// Sent by: Server
// Received by: Players
// Fields
{
    'type': "questionResult",
    'answerOptions' : [{
        'answerOptionId': string,
        'answerOptionVotes': number,
        'isCorrect': bool
    }, ...]
}
```
```json
// Name: actualScoreBoardMessage
// Description:
// Sent by: Server
// Received by: Players
// Fields
{
    'type': "actualScoreBoard",
    'players': [{
        'showName' : string,
        'points' : number
    }, ...] //Ordered by decreasing points
}
```
```json
// Name: generalScoreBoardMessage
// Description:
// Sent by: Server
// Received by: Players
// Fields
{
    'type': "generalScoreBoard",
    'players': [{
        'showName' : string,
        'points' : number
    }, ...] //Ordered by decreasing points
}
```
```json
// Name: questionMessage
// Description:
// Sent by: Server
// Received by: Players
// Fields
{
    'type': "question",
    'question': {
        'questionId': string,
        'questionText' : string,
        'answerOptions' : [{
            'answerOptionId': string,
            'answerOptionText' : string
        }, ...] //4 elements in the Iterable
    }
}
```
```json
// Name: endGameMessage
// Description:
// Sent by: Server
// Received by: Players
// Fields
{
    'type': "endGame"
}
```

